<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль - UGC PRO</title>
    <link rel="stylesheet" href="css/profile.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .profile-container {
            padding-bottom: 80px; /* Отступ для фиксированной кнопки */
        }
        
        .fixed-button-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--tg-theme-bg-color, #fff);
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .save-button {
            width: 100%;
            padding: 12px;
            background: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .save-button:active {
            opacity: 0.8;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            font-size: 16px; /* Оптимальный размер для предотвращения зума на iOS */
        }
    </style>
</head>
<body>
    <div class="profile-container">
        <h1>Профиль пользователя</h1>
        <form id="profile-form">
            <!-- Основная информация -->
            <div class="form-group">
                <label for="name">Имя</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="phone">Телефон</label>
                <input type="tel" id="phone" name="phone">
            </div>

            <div class="form-group">
                <label for="telegram">Telegram</label>
                <input type="text" id="telegram" name="telegram">
            </div>

            <div class="form-group">
                <label for="role">Роль</label>
                <select id="role" name="role" required>
                    <option value="blogger">Блогер</option>
                    <option value="brand">Бренд</option>
                </select>
            </div>

            <!-- Категории -->
            <div class="form-group">
                <label>Категории</label>
                <div class="categories-grid">
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="beauty">
                        <span>Красота</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="fashion">
                        <span>Мода</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="lifestyle">
                        <span>Лайфстайл</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="tech">
                        <span>Технологии</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="food">
                        <span>Еда</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="travel">
                        <span>Путешествия</span>
                    </label>
                    <label class="category-item">
                        <input type="checkbox" name="categories" value="sport">
                        <span>Спорт</span>
                    </label>
                </div>
            </div>

            <!-- Поля для блогера -->
            <div class="role-specific blogger-fields">
                <div class="form-group">
                    <label for="description">О себе</label>
                    <textarea id="description" name="description"></textarea>
                </div>

                <div class="form-group">
                    <label for="audience">Количество подписчиков</label>
                    <input type="number" id="audience" name="audience">
                </div>

                <div class="form-group">
                    <label for="price">Стоимость размещения (₽)</label>
                    <input type="number" id="price" name="price">
                </div>
            </div>

            <!-- Поля для бренда -->
            <div class="role-specific brand-fields">
                <div class="form-group">
                    <label for="company">Название компании</label>
                    <input type="text" id="company" name="company">
                </div>

                <div class="form-group">
                    <label for="website">Сайт</label>
                    <input type="url" id="website" name="website">
                </div>
            </div>
        </form>
    </div>

    <!-- Фиксированная кнопка сохранения -->
    <div class="fixed-button-container">
        <button type="submit" form="profile-form" class="save-button">Сохранить</button>
    </div>

    <script>
        // Функция для работы с localStorage
        const userData = {
            get: () => JSON.parse(localStorage.getItem('userData') || '{}'),
            set: (data) => localStorage.setItem('userData', JSON.stringify(data)),
            update: (newData) => {
                const currentData = userData.get();
                userData.set({ ...currentData, ...newData });
            }
        };

        // Обработка изменения роли
        document.getElementById('role').addEventListener('change', function(e) {
            const bloggerFields = document.querySelectorAll('.blogger-fields');
            const brandFields = document.querySelectorAll('.brand-fields');
            
            if (e.target.value === 'blogger') {
                bloggerFields.forEach(el => el.style.display = 'block');
                brandFields.forEach(el => el.style.display = 'none');
            } else {
                bloggerFields.forEach(el => el.style.display = 'none');
                brandFields.forEach(el => el.style.display = 'block');
            }
        });

        // Загрузка данных пользователя
        window.addEventListener('load', function() {
            const data = userData.get();
            if (data) {
                // Заполняем основные поля
                ['name', 'email', 'phone', 'telegram', 'role', 'description', 
                 'audience', 'price', 'company', 'website'].forEach(field => {
                    const element = document.getElementById(field);
                    if (element && data[field]) {
                        element.value = data[field];
                    }
                });

                // Заполняем категории
                if (data.categories && Array.isArray(data.categories)) {
                    data.categories.forEach(category => {
                        const checkbox = document.querySelector(`input[name="categories"][value="${category}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                }

                // Активируем нужные поля в зависимости от роли
                document.getElementById('role').dispatchEvent(new Event('change'));
            }
        });

        // Сохранение данных
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Собираем данные формы
            const formData = new FormData(this);
            const data = {};
            
            // Обрабатываем обычные поля
            for (let [key, value] of formData.entries()) {
                if (key !== 'categories') {
                    data[key] = value;
                }
            }
            
            // Обрабатываем категории отдельно
            data.categories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
                .map(checkbox => checkbox.value);
            
            // Сохраняем данные
            userData.set(data);
            
            // Показываем уведомление
            alert('Профиль успешно сохранен!');
            
            // Обновляем страницу
            window.location.reload();
        });

        // Интеграция с Telegram WebApp
        if (window.Telegram?.WebApp) {
            const webApp = window.Telegram.WebApp;
            webApp.ready();
            
            // Устанавливаем тему
            if (webApp.colorScheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }
    </script>
</body>
</html>
